#!/usr/bin/env bash

## Author : Customized by Honey (based on adi1090x)
## Rofi Power Menu — Simplified for i3 + Flat Style Theme

# Constants
uptime="$(uptime -p | sed -e 's/up //g')"
theme="$HOME/.config/rofi/themes/tokyonight-powermenu.rasi"

# Icons
shutdown=''
reboot=''
lock=''
suspend=''
logout=''
yes=''
no=''

# Rofi Launcher
rofi_cmd() {
  rofi -dmenu \
    -p "Uptime: $uptime" \
    -mesg "Uptime: $uptime" \
    -theme "$theme"
}

# Confirmation Prompt
confirm_cmd() {
  rofi -theme-str 'window {location: center; anchor: center; fullscreen: false; width: 350px;}' \
    -theme-str 'mainbox {children: [ "message", "listview" ];}' \
    -theme-str 'listview {columns: 2; lines: 1;}' \
    -theme-str 'element-text {horizontal-align: 0.5;}' \
    -theme-str 'textbox {horizontal-align: 0.5;}' \
    -dmenu \
    -p 'Confirmation' \
    -mesg 'Are you sure?' \
    -theme "$theme"
}

# Ask for confirmation
confirm_exit() {
  echo -e "$yes\n$no" | confirm_cmd
}

# Display Menu
run_rofi() {
  echo -e "$lock\n$suspend\n$logout\n$reboot\n$shutdown" | rofi_cmd
}

# Command Dispatcher
run_cmd() {
  case "$1" in
  --lock)
    ~/.config/i3/scripts/screenlock
    ;;
  *)
    selected="$(confirm_exit)"
    if [[ "$selected" == "$yes" ]]; then
      case "$1" in
      --shutdown) systemctl poweroff ;;
      --reboot) systemctl reboot ;;
      --suspend)
        mpc -q pause
        amixer set Master mute
        systemctl suspend
        ;;
      --logout) i3-msg exit ;;
      esac
    else
      exit 0
    fi
    ;;
  esac
}

# Main Logic
chosen="$(run_rofi)"
case "$chosen" in
$shutdown) run_cmd --shutdown ;;
$reboot) run_cmd --reboot ;;
$lock) run_cmd --lock ;;
$suspend) run_cmd --suspend ;;
$logout) run_cmd --logout ;;
esac
